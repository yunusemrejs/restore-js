!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["restore-js"]={})}(this,(function(t){"use strict";var e=Object.defineProperty,s=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);class i{constructor(t){s(this,"state"),s(this,"actions"),s(this,"mutations"),s(this,"middlewares"),s(this,"listeners"),s(this,"nextListenerId");const{state:e,actions:i={},mutations:n={},middlewares:o={}}=t;this.state=e,this.actions=i,this.mutations=n,this.middlewares=o,this.listeners=new Map,this.nextListenerId=0}getState(){return this.state}setState(t){const e=Object.assign({},t);this.state=e,this.notify()}subscribe(t){const e=this.nextListenerId++;return this.listeners.set(e,t),e}unsubscribe(t){this.listeners.delete(t)}notify(t){const e=Object.assign({},this.state);this.listeners.forEach((s=>{t&&0!=t.size?(0===s.watchedStates.size||Array.from(t).some((t=>s.watchedStates.has(t))))&&s.callback(e):s.callback(e)}))}async dispatch(t,e){const s=this.actions[t];if(!s)return void console.error(`Action '${t}' not found.`);let i=e;for(const n of Object.keys(this.middlewares)){const e=this.middlewares[n];i=await e({actionName:t,payload:i})}return s(this,i)}async commit(t,e){const s=this.mutations[t];if(!s)return void console.error(`Mutation '${t}' not found.`);const i=this.state,n=s(this.state,e);"function"==typeof(null==n?void 0:n.then)&&await n;const o=new Set;for(const a of Object.keys(i))i[a]!==this.state[a]&&o.add(a);this.notify(o)}}t.ReStore=i,t.createStore=function(t){return new i(t)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
