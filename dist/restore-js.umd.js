!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self)["restore-js"]={})}(this,(function(t){"use strict";var s=Object.defineProperty,e=(t,e,i)=>(((t,e,i)=>{e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);class i{constructor(t){e(this,"state"),e(this,"actions"),e(this,"mutations"),e(this,"middlewares"),e(this,"listeners"),e(this,"queuedListeners"),e(this,"isUpdating");const{state:s,actions:i={},mutations:n={},middlewares:o=[]}=t;this.state=s,this.actions=i,this.mutations=n,this.middlewares=o,this.listeners=[],this.queuedListeners=[],this.isUpdating=!1}getState(){return this.state}setState(t){const s=Object.assign({},t);this.isUpdating?this.queuedListeners.push((()=>{this.state=s,this.notify()})):(this.isUpdating=!0,this.state=s,this.notify(),this.isUpdating=!1,this.queuedListeners.forEach((t=>t())),this.queuedListeners=[])}subscribe(t){this.listeners.push(t)}unsubscribe(t){this.listeners=this.listeners.filter((s=>s!==t))}notify(t=[]){const s=Object.assign({},this.state);this.listeners.forEach((e=>{t.length||e.callback(s),(0===e.watchedStates.length||e.watchedStates.some((s=>t.includes(s))))&&e.callback(s)}))}async dispatch(t,s){const e=this.actions[t];if(e){const i={store:this,actionName:t,payload:s},n=this.middlewares.map((t=>t(i)));let o=e(this,s);for(const t of n)o=await t(o);return o}console.error(`Action '${t}' not found.`)}async commit(t,s){const e=this.mutations[t];if(e){const t=this.state,i=e(this.state,s);"function"==typeof(null==i?void 0:i.then)&&await i;const n=Object.keys(this.state).filter((s=>this.state[s]!==t[s]));this.notify(n)}else console.error(`Mutation '${t}' not found.`)}}t.ReStore=i,t.createStore=function(t){return new i(t)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
